---
title: Volatile关键字
date: '2017/8/01 10:56:41'
copyright: true
categories:
  - NoteBook
tags:
  - JAVA
  - 基础
  - 多线程
abbrlink: 3fbd301a
---
![volatile](vol.jpg)

**Volatile 能够保证可见性。**

>  volatile的两大特性：禁止重排序、内存可见性。

    1）保证了不同线程对这个变量进行操作时的可见性，即一个线程修改了某个变量的值，这新值对其他线程来说是立即可见的。
    2）禁止进行指令重排序。

<!-- more -->
并发编程中三大概念：**原子性，有序性，可见性。**

---

### 1.原子性
一个操作或者多个操作，要么全部执行并且执行过程中不会被任何一个因素打扰，要么就不会执行。
Java中，对于基本数据类型的变量读取和赋值操作是原子的。

```
x=10;   //1
y=x;    //2
x++;    //3
x=x+1;  //4

```
只有1是原子的操作。

2是两个操作，先读取x的值，在把x的值写入工作内存，这两个操作都是原子操作，放在一起就不是原子操作了。

3和4都是先读取x的值，在进行加一的操作，写入新的值。

只有简单的读取、赋值（变量之间赋值不是）才是原子操作。

可以通过synchronized和Lock解决原子性问题。

### 2.可见性
线程之间的可见性，一个线程修改这个变量的值，其他的线程能够立即看到修改的值。

Java中，volatile关键字来保证可见性。
被volatile修饰的变量，变量修改的值会立即更新到主存，当其他线程需要读取的时候。就会读取主存的值。

普通变量被修改的时候，什么时候写入主存是不确定的。当其他线程读取的时候可能还是原来的值，因此无法保证可见性。

synchronized和Lock也能保证可见性，能够保证同一时刻只有一个线程获取锁，并且在释放锁之前会将变量修改刷新到主存中。

### 3.有序性
程序执行的顺序按照代码先后执行。

指令重排序不会影响单个线程的执行，会影响到线程并发执行的正确性。

Java中允许编译器和处理器对指令进行重排序，volatile、synchronized和Lock都可以保证有序性，

### 应用场景
1.状态标记量
2.double check
---
volatile实现原理























